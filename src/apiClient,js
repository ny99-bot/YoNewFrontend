// src/apiClient.js

const API_BASE = "https://yonewbackend.onrender.com"; // <-- your Render backend URL

// Temporary "user id" helper.
// Later this will come from real auth. For now we just make a stable ID.
export function getUid() {
  let uid = localStorage.getItem("uid");
  if (!uid) {
    uid = "demo-user";
    localStorage.setItem("uid", uid);
  }
  return uid;
}

// Fetch trip info + its items for a given tripId
export async function fetchTripDetails(uid, tripId) {
  // 1. Get list of this user's trips
  const tripsRes = await fetch(
    `${API_BASE}/trips/list?uid=${encodeURIComponent(uid)}`
  );

  const tripsJson = await tripsRes.json();
  // tripsJson should look like { ok: true, data: { trips: [...] } }
  const trips = tripsJson?.data?.trips || [];

  // find the one trip we care about
  const trip = trips.find(t => t.id === tripId);

  // If not found, return "nothing" so TripSummary can show "Trip not found"
  if (!trip) {
    return { trip: null, items: [] };
  }

  // 2. Fetch this trip's items
  const itemsRes = await fetch(
    `${API_BASE}/trips/items?uid=${encodeURIComponent(uid)}&tripId=${encodeURIComponent(tripId)}`
  );

  const itemsJson = await itemsRes.json();
  // itemsJson should look like { ok: true, data: { items: [...] } }
  const items = itemsJson?.data?.items || [];

  // Return both together
  return { trip, items };
}
