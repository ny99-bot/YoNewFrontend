// src/apiClient.js

const API_BASE = "https://yonewbackend.onrender.com"; // your Render backend URL

// --- Simple temp user id until real auth ---
export function getUid() {
  let uid = localStorage.getItem("uid");
  if (!uid) {
    uid = "demo-user";
    localStorage.setItem("uid", uid);
  }
  return uid;
}

// --- List all trips for this user ---
export async function listTrips(uid) {
  // GET /trips/list?uid=...
  const res = await fetch(
    `${API_BASE}/trips/list?uid=${encodeURIComponent(uid)}`
  );

  const json = await res.json();
  // backend responds { ok: true, data: { trips: [...] } }
  return json?.data?.trips || [];
}

// --- Fetch trip details + items ---
export async function fetchTripDetails(uid, tripId) {
  // 1. get all trips
  const trips = await listTrips(uid);

  // 2. find the one we care about
  const trip = trips.find(t => t.id === tripId);
  if (!trip) {
    return { trip: null, items: [] };
  }

  // 3. load its items
  const itemsRes = await fetch(
    `${API_BASE}/trips/items?uid=${encodeURIComponent(uid)}&tripId=${encodeURIComponent(tripId)}`
  );

  const itemsJson = await itemsRes.json();
  const items = itemsJson?.data?.items || [];

  return { trip, items };
}
